---
layout: post
tags:
  - omarchy
  - formatting
---








### è‡ªåŠ¨æ£€æµ‹ç‰ˆè„šæœ¬

ä¿å­˜ä¸º `~/scripts/wechat-toggle.sh`ï¼š
```shell
#!/bin/bash

# è‡ªåŠ¨æ£€æµ‹å¾®ä¿¡çª—å£ class
get_wechat_class() {
    hyprctl clients | grep -i "wechat" | grep "class:" | head -n1 | awk '{print $2}'
}

WIN_CLASS=$(get_wechat_class)

# å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ï¼Œé»˜è®¤ç”¨ wechat
if [ -z "$WIN_CLASS" ]; then
    WIN_CLASS="wechat"
fi

# æ£€æŸ¥å¾®ä¿¡æ˜¯å¦è¿è¡Œ
if ! pgrep -i wechat >/dev/null; then
    # æ²¡æœ‰è¿è¡Œå°±å¯åŠ¨
    wechat &
    exit 0
fi

# å¾®ä¿¡åœ¨è¿è¡Œï¼Œæ£€æŸ¥çª—å£ä¿¡æ¯
WIN_INFO=$(hyprctl clients | grep -i "class: $WIN_CLASS" -A 10)

if [ -z "$WIN_INFO" ]; then
    # æ²¡æ‰¾åˆ°çª—å£ï¼ˆå¯èƒ½åœ¨åå°ï¼‰ï¼Œé‡æ–°å¯åŠ¨
    wechat &
    exit 0
fi

# å¦‚æœçª—å£å·²èšç„¦ â†’ æœ€å°åŒ–åˆ°ä¸€ä¸ªéšè— workspace
if echo "$WIN_INFO" | grep -q "focused: yes"; then
    hyprctl dispatch movetoworkspacesilent special:hidden "class:^(?i)$WIN_CLASS$"
else
    # å¦åˆ™èšç„¦åˆ°å®ƒ
    hyprctl dispatch focuswindow "class:^(?i)$WIN_CLASS$"
fi
```


### ä½¿ç”¨æ–¹æ³•

1. ç»™æƒé™ï¼š
```shell
chmod +x ~/scripts/wechat-toggle.sh
```

2. åœ¨ `~/.config/hypr/hyprland.conf` é‡Œæ·»åŠ ï¼š
```shell
bind = SUPER, W, exec, ~/scripts/wechat-toggle.sh
```


è¿™æ ·æ•ˆæœå°±æ˜¯ï¼š

- `SUPER + W`
    
    - å¦‚æœå¾®ä¿¡æ²¡å¼€ â†’ å¯åŠ¨å¾®ä¿¡
        
    - å¦‚æœå¾®ä¿¡åœ¨åå° â†’ åˆ‡æ¢åˆ°å‰å°
        
    - å¦‚æœå¾®ä¿¡å·²åœ¨å‰å° â†’ éšè—åˆ°ä¸€ä¸ª `special:hidden` çš„ workspace




## ğŸ”¹ æ”¹è¿›åçš„ toggle è„šæœ¬ï¼ˆæ”¯æŒè·¨ workspaceï¼‰

ä¿å­˜ä¸º `~/scripts/toggle-app.sh`ï¼š


```shell
#!/bin/bash
APP=$1

# æ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œ
if ! pgrep -x "$APP" >/dev/null; then
    $APP &
    exit 0
fi

# æŸ¥æ‰¾çª—å£ä¿¡æ¯
WIN_INFO=$(hyprctl clients | awk -v app="$APP" '
    BEGIN {IGNORECASE=1}
    /class:/ {cls=$2}
    /workspace:/ {ws=$2}
    /address:/ {addr=$2}
    /focused:/ {f=$2}
    {
      if (tolower(cls)==tolower(app)) {
        print cls, ws, addr, f
      }
    }')

if [ -z "$WIN_INFO" ]; then
    $APP &
    exit 0
fi

# è§£æç»“æœï¼ˆå–ç¬¬ä¸€ä¸ªåŒ¹é…çª—å£ï¼‰
read CLS WS ADDR FOCUSED <<< "$WIN_INFO"

if [ "$FOCUSED" == "yes" ]; then
    # å¦‚æœå·²èšç„¦ â†’ éšè—åˆ° special:hidden
    hyprctl dispatch movetoworkspacesilent special:hidden "class:^(?i)$APP$"
else
    if [ "$WS" != "$(hyprctl activeworkspace -j | jq -r .id)" ]; then
        # å¦‚æœåœ¨å…¶ä»– workspace â†’ åˆ‡è¿‡å»
        hyprctl dispatch workspace "$WS"
    fi
    # èšç„¦çª—å£
    hyprctl dispatch focuswindow "class:^(?i)$APP$"
fi

```



## ğŸ”¹ ä½¿ç”¨æ–¹å¼

1. ç»™æ‰§è¡Œæƒé™ï¼š
```shell
chmod +x ~/scripts/toggle-app.sh
```


2. åœ¨ ~/.config/hypr/hyprland.conf é‡Œé…ç½®ï¼š
```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram-desktop
bind = SUPER, B, exec, ~/scripts/toggle-app.sh firefox
bind = SUPER, Return, exec, ~/scripts/toggle-app.sh kitty
```


## ğŸ”¹ æ•ˆæœ

- å¦‚æœæ²¡è¿è¡Œ â†’ å¯åŠ¨
    
- å¦‚æœåœ¨å½“å‰ workspace â†’ èšç„¦æˆ–éšè—
    
- å¦‚æœåœ¨å…¶ä»– workspace â†’ è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº” workspace å¹¶èšç„¦
    
- å†æŒ‰ä¸€æ¬¡ â†’ éšè—åˆ° `special:hidden`


```
$(hyprctl clients | awk -v app="wechat" '
    BEGIN {IGNORECASE=1}
    /class:/ {cls=$2}
    /workspace:/ {ws=$2}
    /address:/ {addr=$2}
    /focused:/ {f=$2}
    {
      if (tolower(cls)==tolower(app)) {
        print cls, ws, addr, f
      }
    }')
    
    
    hyprctl clients -j | jq -r --arg app "wechat" '
    .[] | select(.class | ascii_downcase == ($app | ascii_downcase)) 
    | "\(.class) \(.workspace.id) \(.address)"' | head -n1
    
```




æ²¡æœ‰focused


å•Šï¼Œæ˜ç™½äº† ğŸ‘ã€‚  
ä½ åœ¨ `hyprctl clients` é‡Œçœ‹åˆ°çš„è¾“å‡ºé‡Œ **æ²¡æœ‰ `focused:` å­—æ®µ**ï¼Œè¿™æ˜¯å› ä¸º Hyprland åœ¨ä¸åŒç‰ˆæœ¬é‡Œ `clients` çš„è¾“å‡ºæ ¼å¼å˜è¿‡ã€‚

æœ‰çš„ç‰ˆæœ¬é‡Œ `hyprctl clients` è¾“å‡ºçš„æ˜¯ï¼š
```shell
class: firefox
title: Mozilla Firefox
workspace: 2
address: 0x55d9e6e
at: 1920,30
...
focusHistoryID: 12

```

æ²¡æœ‰ `focused: yes/no`ã€‚  
è¦åˆ¤æ–­æŸä¸ªçª—å£æ˜¯ä¸æ˜¯å‰å°ï¼Œå°±è¦**å¯¹æ¯”å®ƒçš„ workspace å’Œå½“å‰æ´»åŠ¨çš„ workspace**ã€‚



## ğŸ”¹ æ”¹è¿›ç‰ˆï¼ˆå…¼å®¹æ²¡æœ‰ `focused` å­—æ®µçš„æƒ…å†µï¼‰

æ›´æ–°åçš„ `toggle-app.sh`ï¼š

```shell
#!/bin/bash
APP=$1

# æ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œ
if ! pgrep -x "$APP" >/dev/null; then
    $APP &
    exit 0
fi

# å½“å‰ workspace ID
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)

# æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„çª—å£
WIN_INFO=$(hyprctl clients -j | jq -r --arg app "$APP" '
    .[] | select(.class | ascii_downcase == ($app | ascii_downcase)) 
    | "\(.class) \(.workspace.id) \(.address)"' | head -n1)

if [ -z "$WIN_INFO" ]; then
    $APP &
    exit 0
fi

read CLS WS ADDR <<< "$WIN_INFO"

if [ "$WS" -eq "$CUR_WS" ]; then
    # å¦‚æœåœ¨å½“å‰ workspace â†’ éšè—åˆ° special:hidden
    hyprctl dispatch movetoworkspacesilent special:hidden "address:$ADDR"
else
    # å¦‚æœåœ¨å…¶ä»– workspace â†’ åˆ‡æ¢å¹¶èšç„¦
    hyprctl dispatch workspace "$WS"
    hyprctl dispatch focuswindow "address:$ADDR"
fi

```


## ğŸ”¹ å…³é”®ç‚¹

- è¿™é‡Œç”¨ `hyprctl clients -j`ï¼ˆJSON æ ¼å¼ï¼‰ï¼Œå†ç”¨ `jq` è§£æï¼š
    
    - `.class` â†’ åº”ç”¨ç±»å
        
    - `.workspace.id` â†’ çª—å£æ‰€åœ¨çš„ workspace
        
    - `.address` â†’ çª—å£åœ°å€ï¼ˆå”¯ä¸€ IDï¼‰
        
- åˆ¤æ–­é€»è¾‘æ”¹æˆï¼š
    
    - **åœ¨å½“å‰ workspace** â†’ éšè—åˆ° `special:hidden`
        
    - **åœ¨å…¶ä»– workspace** â†’ åˆ‡æ¢è¿‡å»å¹¶èšç„¦



## ğŸ”¹ é…ç½®æ–¹å¼

åŒæ ·åœ¨ `hyprland.conf` é‡Œå†™ï¼š

```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram-desktop
bind = SUPER, B, exec, ~/scripts/toggle-app.sh firefox

```


è¿™æ ·å°±ä¸ä¼šä¾èµ– `focused` å­—æ®µäº† âœ…ã€‚


******************************************

éšè—åå†æ‰“å¼€ ä¸å¹³é“ºçª—å£


ğŸ‘Œ ä½ è¯´çš„æƒ…å†µæ˜¯ï¼š  
è„šæœ¬é‡ŒæŠŠçª—å£ **ç§»åˆ° `special:hidden`** workspace ä¹‹åï¼Œå†åˆ‡å›æ¥æ—¶ï¼Œçª—å£ä¸æ˜¯å¹³é“ºçŠ¶æ€äº†ï¼ˆæ¯”å¦‚å˜æˆæµ®åŠ¨ã€å°ºå¯¸ä¹±æ‰ï¼‰ã€‚

è¿™æ˜¯å› ä¸ºï¼š

- `special:hidden` æœ¬èº«æ˜¯ä¸€ä¸ª **ç‰¹æ®Š workspace**ï¼Œçª—å£åˆ‡è¿›å»åˆ‡å‡ºæ¥æ—¶ï¼ŒHyprland å¯èƒ½ä¼šæ”¹å˜å®ƒçš„ **tiling/floating çŠ¶æ€**ã€‚
    
- å¦å¤–ï¼Œ`hyprctl dispatch movetoworkspacesilent` æ²¡æœ‰å¼ºåˆ¶ä¿æŒ tilingã€‚


## ğŸ”¹ è§£å†³æ€è·¯

1. **è®°å½•çª—å£åŸæœ¬çš„çŠ¶æ€**ï¼ˆtiling/floatingï¼‰ã€‚
    
2. éšè—æ—¶ â†’ ç§»åˆ° `special:hidden`ã€‚
    
3. å†æ˜¾ç¤ºæ—¶ â†’ æŠŠå®ƒç§»å›åŸæ¥çš„ workspaceï¼Œå¹¶æ¢å¤ tiling çŠ¶æ€ã€‚

## ğŸ”¹ æ”¹è¿›è„šæœ¬ï¼šä¿è¯çª—å£æ¢å¤å¹³é“º

ä¿å­˜ä¸º `~/scripts/toggle-app.sh`ï¼š

```shell
#!/bin/bash
APP=$1

STATE_FILE="/tmp/hypr_toggle_${APP}.state"

# æ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œ
if ! pgrep -x "$APP" >/dev/null; then
    $APP &
    exit 0
fi

CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)

# æ‰¾çª—å£ä¿¡æ¯
WIN_INFO=$(hyprctl clients -j | jq -r --arg app "$APP" '
    .[] | select(.class | ascii_downcase == ($app | ascii_downcase))
    | "\(.workspace.id) \(.address) \(.floating)"' | head -n1)

if [ -z "$WIN_INFO" ]; then
    $APP &
    exit 0
fi

read WS ADDR FLOATING <<< "$WIN_INFO"

if [ "$WS" -eq "$CUR_WS" ]; then
    # å·²åœ¨å½“å‰ workspace â†’ éšè—
    echo "$CUR_WS $FLOATING" > "$STATE_FILE"
    hyprctl dispatch movetoworkspacesilent special:hidden "address:$ADDR"
else
    if [ "$WS" = "special:hidden" ]; then
        # ä»éšè—æ¢å¤ â†’ ç§»å›åŸ workspace
        if [ -f "$STATE_FILE" ]; then
            read OLD_WS OLD_FLOATING < "$STATE_FILE"
            hyprctl dispatch movetoworkspacesilent "$OLD_WS" "address:$ADDR"
            # æ¢å¤ tiling çŠ¶æ€
            if [ "$OLD_FLOATING" == "false" ]; then
                hyprctl dispatch toggletiling "address:$ADDR"
            fi
            rm "$STATE_FILE"
        else
            hyprctl dispatch movetoworkspacesilent "$CUR_WS" "address:$ADDR"
        fi
    else
        # åœ¨å…¶ä»– workspace â†’ åˆ‡è¿‡å»å¹¶èšç„¦
        hyprctl dispatch workspace "$WS"
        hyprctl dispatch focuswindow "address:$ADDR"
    fi
fi

```

## ğŸ”¹ é€»è¾‘è¯´æ˜

- ç¬¬ä¸€æ¬¡éšè—æ—¶ â†’ æŠŠ **åŸ workspace + æ˜¯å¦æµ®åŠ¨** å†™åˆ° `/tmp/hypr_toggle_APP.state`ã€‚
    
- å†æ¬¡åˆ‡æ¢æ—¶ â†’ å¦‚æœçª—å£åœ¨ `special:hidden`ï¼Œå°±ï¼š
    
    1. ç§»å›åŸ workspace
        
    2. å¦‚æœä¹‹å‰æ˜¯ tiling â†’ å¼ºåˆ¶ `toggletiling`ï¼Œä¿è¯ä¸æ˜¯æµ®åŠ¨ã€‚

è¿™æ ·ä½ å°±èƒ½åšåˆ°ï¼š

- **æŒ‰å¿«æ·é”® â†’ éšè—**ï¼ˆç§»åˆ° hiddenï¼‰
    
- **å†æŒ‰ä¸€æ¬¡ â†’ æ¢å¤åˆ°åŸ workspaceï¼Œå¹¶ä¿æŒå¹³é“º**




++++++++++++++++++++++++++++++++++++++++++++++++++++


è¿™æ ·æ”¹éƒ½ä¸èƒ½éšè—äº†


Thought for 1m 13s

å¥½â€”â€”æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æŠŠå®ƒä¿®å¥½ã€‚ä½ è¯´â€œè¿™æ ·æ”¹éƒ½ä¸èƒ½éšè—äº†â€ï¼Œ**æœ€å¸¸è§çš„åŸå› **æœ‰ä¸¤æ¡ï¼Œæˆ‘å…ˆæŠŠåŸå› è¯´æ¸…æ¥šå†ç»™ä½ ä¸€ä¸ªå®æˆ˜å¯ç”¨çš„è„šæœ¬ï¼ˆå«è°ƒè¯•æ—¥å¿—ã€å›é€€ç­–ç•¥ï¼‰ï¼Œä½ ç›´æ¥æ›¿æ¢è¯•ä¸€ä¸‹ï¼š

åŸå› æ€»ç»“ï¼ˆç®€çŸ­ï¼‰

- `movetoworkspacesilent` + `special` çš„ç»„åˆåœ¨ä¸åŒ Hyprland ç‰ˆæœ¬/å®ç°ä¸Šè¡Œä¸ºä¸ç¨³å®šæˆ–æœªå®Œå…¨æ”¯æŒï¼Œç¤¾åŒºé‡Œæœ‰ç›¸å…³ reportï¼ˆæ‰€ä»¥ç›´æ¥ç”¨ `movetoworkspacesilent "special,..."` å¯èƒ½æ²¡ä½œç”¨ï¼‰ã€‚[GitHub](https://github.com/hyprwm/Hyprland/issues/1452?utm_source=chatgpt.com)
    
- Special workspace æœ¬èº«æœ‰ä¸€äº›é™åˆ¶ï¼ˆä¾‹å¦‚ special çš„æµ®åŠ¨/tiling è¡Œä¸ºå’Œæ™®é€š workspace ä¸å®Œå…¨ä¸€æ ·ï¼‰ï¼Œwindow åœ¨ special ä¸æ¢å¤æ—¶çŠ¶æ€ä¼šè¢« compositor æ”¹å˜ã€‚æ–‡æ¡£ä¹ŸæŒ‡å‡º special çš„è¡Œä¸ºä¸æ™®é€š workspace ä¸åŒã€‚[Hyprland Wiki](https://wiki.hypr.land/0.18.0beta/Configuring/Dispatchers/?utm_source=chatgpt.com)
    

å› æ­¤æˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š

1. æŠŠéšè—é€»è¾‘åšå¾—æ›´**ç¨³å¥**ï¼ˆå…ˆå°è¯•æœ€ä¼˜ APIï¼Œå¤±è´¥å°±é™çº§åˆ°å¯é çš„ workaroundï¼‰ï¼›
    
2. å›æ˜¾ï¼ˆæ¢å¤ï¼‰æ—¶**æ˜ç¡®ç”¨ `address:` æŒ‡å®šçª—å£**å¹¶åœ¨å¿…è¦æ—¶åšäºŒæ¬¡æ¢å¤ï¼ˆé˜²æ­¢è¢«åŠ¨æˆæµ®åŠ¨ï¼‰ã€‚



# æ¨èè„šæœ¬ï¼ˆå¸¦è°ƒè¯• + å›é€€ï¼‰

æŠŠä¸‹é¢ä¿å­˜ä¸º `~/scripts/wechat-toggle.sh`ï¼ˆæˆ–ä½ åŸæ¥çš„è„šæœ¬åï¼‰ï¼Œå¹¶ `chmod +x`ã€‚è¿™ä¸ªè„šæœ¬ä¼šè®°å½•æ—¥å¿— `/tmp/hypr_toggle_debug.log`ï¼Œå¹¶å°è¯•å¤šç§æ–¹å¼æ¥éšè—/æ¢å¤ï¼ˆå…ˆè¯• silentï¼Œå¤±è´¥å°±ç”¨ movetoworkspace+åˆ‡å› çš„ fallbackï¼‰ï¼š

```shell
#!/usr/bin/env bash
set -euo pipefail
APP="$1"
STATE_DIR="/tmp/hypr_toggle_states"
LOG="/tmp/hypr_toggle_debug.log"
mkdir -p "$STATE_DIR"
: >"$LOG"

dbg(){ echo "$(date +%T) $*" >>"$LOG"; }

# find first matching window's address
WIN_JSON=$(hyprctl clients -j 2>/dev/null || echo "[]")
ADDR=$(echo "$WIN_JSON" | jq -r --arg app "$APP" '
  .[] | select((.class // "" | ascii_downcase) == ($app|ascii_downcase)) | .address' | head -n1 || true)

if [ -z "$ADDR" ] || [ "$ADDR" = "null" ]; then
  dbg "No running window for '$APP' found. Starting it."
  # ä¿®æ”¹ä¸ºä½ çš„å¯åŠ¨å‘½ä»¤ï¼ˆå¦‚æœå¯æ‰§è¡Œåä¸åŒï¼‰
  $APP & disown
  exit 0
fi

# workspace ids and names
WIN_WS=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.id // "-1")' )
WIN_WS_NAME=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.name // "")' )
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)

dbg "Found $APP addr=$ADDR ws=$WIN_WS ws_name='$WIN_WS_NAME' cur_ws=$CUR_WS"

STATE_FILE="$STATE_DIR/${ADDR}.state"

# Helper to re-query where the window is now
where_is() {
  hyprctl clients -j | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.id // "-1")' || echo "-1"
}

# 1) å¦‚æœçª—å£åœ¨å½“å‰ workspace -> éšè—ï¼ˆmove to specialï¼‰
if [ "$WIN_WS" -eq "$CUR_WS" ]; then
  dbg "Attempting to hide (current ws)"
  # ä¿å­˜åŸ workspace åˆ°çŠ¶æ€æ–‡ä»¶ï¼Œä¾¿äºæ¢å¤
  echo "$CUR_WS" > "$STATE_FILE"

  # å°è¯• 1: movetoworkspacesilent special,address:ADDR ï¼ˆä¼˜é›…ä½†å¯èƒ½ä¸æ”¯æŒ specialï¼‰
  if hyprctl dispatch movetoworkspacesilent "special,address:${ADDR}" >/dev/null 2>&1; then
    sleep 0.05
    NEWWS=$(where_is)
    if [ "$NEWWS" != "$CUR_WS" ]; then
      dbg "Hidden via movetoworkspacesilent to ws=$NEWWS"
      exit 0
    fi
    dbg "movetoworkspacesilent didn't move the window (no-op)."
  else
    dbg "movetoworkspacesilent returned non-zero or errored."
  fi

  # å›é€€æ–¹æ¡ˆï¼ˆå¯é ï¼‰ï¼šmovetoworkspace special (ä¼šåˆ‡åˆ° special)ï¼Œå†åˆ‡å›åŸ workspace
  dbg "Fallback: movetoworkspace special + switch back to $CUR_WS"
  hyprctl dispatch movetoworkspace "special,address:${ADDR}"
  # åˆ‡å›ä¹‹å‰çš„ workspaceï¼ˆè¿™æ ·ç”¨æˆ·æ„Ÿè§‰æ²¡æœ‰åˆ‡æ¢åˆ° specialï¼‰
  hyprctl dispatch workspace "$CUR_WS"
  sleep 0.05
  NEWWS=$(where_is)
  dbg "After fallback, window ws=$NEWWS"
  exit 0
fi

# 2) å¦‚æœçª—å£ä¸åœ¨å½“å‰ workspace
# æ£€æŸ¥æ˜¯å¦åœ¨ specialï¼ˆåˆ¤æ–­ workspace åæˆ–ç‰¹æ®Š idï¼‰
IS_SPECIAL=false
# æœ‰äº› hyprctl ç‰ˆæœ¬ä¼šåœ¨ .workspace.name / .workspace.special æä¾›ä¿¡æ¯ï¼›æˆ‘ä»¬å°½é‡å®¹é”™åˆ¤æ–­
if [ "$WIN_WS" = "-1" ] || echo "$WIN_WS_NAME" | grep -qi "special"; then
  IS_SPECIAL=true
fi

if $IS_SPECIAL; then
  dbg "Window appears to be in special workspace -> restoring"

  # è¯»å–ä¹‹å‰ä¿å­˜çš„åŸ workspaceï¼ˆæ²¡æœ‰å°±ç”¨å½“å‰ï¼‰
  if [ -f "$STATE_FILE" ]; then
    OLD_WS=$(cat "$STATE_FILE")
  else
    OLD_WS="$CUR_WS"
  fi

  dbg "Trying movetoworkspacesilent back to $OLD_WS"
  if hyprctl dispatch movetoworkspacesilent "${OLD_WS},address:${ADDR}" >/dev/null 2>&1; then
    sleep 0.05
    hyprctl dispatch workspace "$OLD_WS"
    hyprctl dispatch focuswindow "address:${ADDR}"
    rm -f "$STATE_FILE"
    dbg "Restored via movetoworkspacesilent to $OLD_WS"
    exit 0
  fi

  dbg "Fallback restore: toggling special/showing + movetoworkspace back"
  # best-effort fallback: show special, then move the window back (some versions require non-silent)
  hyprctl dispatch togglespecialworkspace __TEMP || true
  hyprctl dispatch togglespecialworkspace __TEMP || true
  hyprctl dispatch movetoworkspace "${OLD_WS},address:${ADDR}" || true
  hyprctl dispatch workspace "$OLD_WS"
  hyprctl dispatch focuswindow "address:${ADDR}" || true
  rm -f "$STATE_FILE"
  dbg "Fallback restore attempted."
  exit 0
fi

# æœ€åï¼šçª—å£åœ¨åˆ«çš„æ™®é€š workspace -> ç›´æ¥åˆ‡è¿‡å»å¹¶ focus
dbg "Window in other workspace ($WIN_WS) -> switch and focus"
hyprctl dispatch workspace "$WIN_WS"
hyprctl dispatch focuswindow "address:${ADDR}"
exit 0

```



# ä½ è¦åšçš„ï¼ˆå¿«é€Ÿï¼‰

1. æŠŠè„šæœ¬ä¿å­˜å¹¶ `chmod +x ~/scripts/wechat-toggle.sh`ã€‚
    
2. åœ¨ `hyprland.conf` é‡Œç»‘å®šï¼ˆä¾‹ï¼‰ï¼š
```
bind = SUPER, W, exec, ~/scripts/wechat-toggle.sh wechat

```

3. è§¦å‘ä¸€æ¬¡éšè—å’Œæ¢å¤ï¼Œè‹¥**è¿˜ä¸èƒ½éšè—**ï¼ŒæŠŠè¿™ä¸¤ä¸ªå‘½ä»¤çš„è¾“å‡ºè´´ä¸Šæ¥ï¼ˆæˆ‘ç›´æ¥çœ‹æ—¥å¿—å’ŒçŠ¶æ€ï¼‰ï¼š
```shell
cat /tmp/hypr_toggle_debug.log
hyprctl clients -j | jq '.[] | {class: .class, address: .address, ws: .workspace.id, name: .workspace.name, floating: .floating}'
hyprctl activeworkspace -j

```

ï¼ˆæŠŠè¾“å‡ºç›´æ¥å¤åˆ¶ç²˜è´´åˆ°èŠå¤©çª—å£å°±è¡Œï¼‰


# å…¶ä»–æ³¨æ„ç‚¹ï¼ˆå¸¸è§å‘ï¼‰

- `jq` å¿…é¡»å®‰è£…ï¼›è„šæœ¬ç”¨äº† `hyprctl clients -j` çš„ JSON è¾“å‡ºæ¥ç²¾ç¡®å®šä½çª—å£ã€‚
    
- æœ‰äº› Hyprland ç‰ˆæœ¬å¯¹ `movetoworkspacesilent`ï¼ˆå°¤å…¶è·Ÿ special é…åˆï¼‰è¡Œä¸ºä¸ä¸€è‡´ï¼›è„šæœ¬é‡Œåšäº†å›é€€ï¼ˆå…ˆè¯• silentï¼Œå†ç”¨ movetoworkspace + åˆ‡å›ï¼‰ã€‚æ–‡æ¡£å’Œ issue éƒ½æœ‰ç›¸å…³æåˆ°ã€‚[Hyprland Wiki+1](https://wiki.hypr.land/0.18.0beta/Configuring/Dispatchers/?utm_source=chatgpt.com)
    
- special workspace å¯¹æµ®åŠ¨/tiling çš„å¤„ç†æœ‰ç‰¹åˆ«è§„åˆ™ï¼ˆå¯èƒ½å¯¼è‡´çª—å£åœ¨ special é‡Œä¸èƒ½æ˜¯æµ®åŠ¨ï¼‰ï¼Œå› æ­¤æ¢å¤æ—¶éœ€è¦æ˜ç¡® `movetoworkspace <ws>,address:...` æˆ–è€… focus åç”¨ `settiled`/`setfloating`ï¼ˆè¿™äº› dispatcher åœ¨ä½ çš„ hyprland ç‰ˆæœ¬é‡Œæ˜¯å¦å¯ç”¨è¯·æ£€æŸ¥ï¼‰

å…ˆæŠŠä¸Šé¢çš„è„šæœ¬è·‘ä¸€ä¸‹ï¼Œç„¶åæŠŠ `/tmp/hypr_toggle_debug.log` å’Œ `hyprctl clients -j | jq ...` çš„è¾“å‡ºè´´ä¸Šæ¥ã€‚æˆ‘ä¼šåŸºäºçœŸå®è¾“å‡ºåšé’ˆå¯¹æ€§ä¿®æ­£ï¼ˆé€šå¸¸é—®é¢˜å°±æ˜¯ â€œmovetoworkspacesilent + special ä¸ç”Ÿæ•ˆâ€ æˆ– â€œwindow spec æ²¡å†™æˆ address:...â€ ä¸¤ç±»ä¹‹ä¸€ï¼‰ã€‚


+++++++++++++++++++++++++++++++++++++++++++++++++



ç°åœ¨å¯ä»¥äº†


###### ChatGPT said:

å¤ªå¥½äº† ğŸ‰ï¼é‚£å°±è¯´æ˜ä¹‹å‰çš„é—®é¢˜ç¡®å®æ˜¯ Hyprland çš„ `special` + `movetoworkspacesilent` è¡Œä¸ºä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œç°åœ¨ç”¨å¸¦å›é€€é€»è¾‘çš„è„šæœ¬å°±ç¨³ä½äº†ã€‚

æ€»ç»“ä¸€ä¸‹ä½ ç°åœ¨çš„æ–¹æ¡ˆï¼š

- **éšè—**ï¼šçª—å£ä»å½“å‰ workspace ç§»åˆ° `special`ï¼ŒåŒæ—¶ä¿æŒä½ åŸæœ¬çš„ workspace ä¸åˆ‡æ¢ã€‚
    
- **æ¢å¤**ï¼šæ ¹æ®ä¿å­˜çš„çŠ¶æ€æŠŠçª—å£ç§»å›åŸ workspaceï¼Œå¹¶è‡ªåŠ¨èšç„¦ã€‚
    
- **å¯é æ€§**ï¼šåŠ äº†å›é€€é€»è¾‘ï¼Œå°±ç®—æŸäº› Hyprland ç‰ˆæœ¬å¯¹ `movetoworkspacesilent special,...` ä¸æ”¯æŒï¼Œä¹Ÿèƒ½é  fallback æ­£å¸¸å·¥ä½œã€‚




è¦ä¸è¦æˆ‘å†å¸®ä½ æ•´ç†ä¸€ä¸ªæ›´**ç²¾ç®€ç‰ˆ**çš„è„šæœ¬ï¼ˆå»æ‰ debug å’Œå¤šä½™åˆ†æ”¯ï¼Œæ–¹ä¾¿é•¿æœŸä½¿ç”¨ï¼‰ï¼Œè¿˜æ˜¯ä¿ç•™ç°åœ¨è¿™ä¸ªå¸¦æ—¥å¿—çš„ç‰ˆæœ¬ï¼ˆæ–¹ä¾¿ä»¥åå‡ºé—®é¢˜æ—¶æ’æŸ¥ï¼‰ï¼Ÿ


å¥½çš„



ğŸ‘Œ é‚£æˆ‘å¸®ä½ æ•´ç†ä¸€ä¸ª **ç²¾ç®€ç¨³å®šç‰ˆ** è„šæœ¬ï¼Œä¿ç•™æ ¸å¿ƒé€»è¾‘ï¼ŒæŠŠè°ƒè¯•æ—¥å¿—å»æ‰ï¼Œæ–¹ä¾¿æ—¥å¸¸ä½¿ç”¨ã€‚

ä¿å­˜ä¸º `~/scripts/toggle-app.sh` å¹¶ `chmod +x`ï¼š


```shell
#!/usr/bin/env bash
set -euo pipefail

APP="$1"
STATE_DIR="/tmp/hypr_toggle_states"
mkdir -p "$STATE_DIR"

# æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çª—å£
WIN_JSON=$(hyprctl clients -j)
ADDR=$(echo "$WIN_JSON" | jq -r --arg app "$APP" '
  .[] | select((.class // "" | ascii_downcase) == ($app|ascii_downcase)) | .address' | head -n1)

if [ -z "$ADDR" ] || [ "$ADDR" = "null" ]; then
  # æ²¡æ‰¾åˆ°å°±å¯åŠ¨åº”ç”¨ï¼ˆæŒ‰éœ€æ”¹ä¸ºä½ çš„å¯åŠ¨å‘½ä»¤ï¼‰
  $APP & disown
  exit 0
fi

WIN_WS=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | .workspace.id')
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)
STATE_FILE="$STATE_DIR/${ADDR}.state"

# helper: ç¡®è®¤çª—å£ç°åœ¨åœ¨å“ªä¸ª workspace
where_is() {
  hyprctl clients -j | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.id // "-1")'
}

# å¦‚æœçª—å£åœ¨å½“å‰ workspace -> éšè—
if [ "$WIN_WS" -eq "$CUR_WS" ]; then
  echo "$CUR_WS" > "$STATE_FILE"

  # ä¼˜å…ˆ silent æ–¹æ³•
  if hyprctl dispatch movetoworkspacesilent "special,address:${ADDR}" >/dev/null 2>&1; then
    exit 0
  fi

  # å›é€€ï¼šmovetoworkspace specialï¼Œç„¶ååˆ‡å›åŸ ws
  hyprctl dispatch movetoworkspace "special,address:${ADDR}"
  hyprctl dispatch workspace "$CUR_WS"
  exit 0
fi

# å¦‚æœçª—å£åœ¨ special -> æ¢å¤
WIN_WS_NAME=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.name // "")')
if [ "$WIN_WS" = "-1" ] || echo "$WIN_WS_NAME" | grep -qi "special"; then
  OLD_WS="$CUR_WS"
  [ -f "$STATE_FILE" ] && OLD_WS=$(cat "$STATE_FILE")

  hyprctl dispatch movetoworkspacesilent "${OLD_WS},address:${ADDR}" || \
    hyprctl dispatch movetoworkspace "${OLD_WS},address:${ADDR}"

  hyprctl dispatch workspace "$OLD_WS"
  hyprctl dispatch focuswindow "address:${ADDR}"
  rm -f "$STATE_FILE"
  exit 0
fi

# å¦åˆ™ï¼šçª—å£åœ¨åˆ«çš„ workspace -> åˆ‡è¿‡å»å¹¶èšç„¦
hyprctl dispatch workspace "$WIN_WS"
hyprctl dispatch focuswindow "address:${ADDR}"
exit 0

```



### ä½¿ç”¨æ–¹æ³•

1. ä¿å­˜å¹¶èµ‹æƒï¼š
```shell
chmod +x ~/scripts/toggle-app.sh
```
2. Hyprland é…ç½®é‡ŒåŠ ç»‘å®šï¼Œä¾‹å¦‚å¾®ä¿¡ï¼š
```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat
```

ï¼ˆ`wechat` è¦å’Œ `hyprctl clients -j` é‡Œ `.class` åä¸€è‡´ï¼Œæ¯”å¦‚ `WeChat.exe`ï¼Œå¯ä»¥è°ƒä¸€ä¸‹ï¼‰



è¿™æ ·å°±æ˜¯ä¸€ä¸ªå¹²å‡€çš„ã€Œä¸€é”®éšè—/æ¢å¤/å¯åŠ¨ã€è„šæœ¬äº†ã€‚

è¦ä¸è¦æˆ‘å†å¸®ä½ å†™ä¸€ä¸ª **é€šç”¨ç‰ˆæœ¬**ï¼Œæ”¯æŒå¤šä¸ª appï¼ˆæ¯”å¦‚ SUPER+F æ‰“å¼€/éšè— Firefoxï¼ŒSUPER+T æ‰“å¼€/éšè— Telegramï¼‰ï¼Œåªç”¨ä¸€ä¸ªè„šæœ¬å°±å¤Ÿï¼Ÿ


å¥½çš„

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

			ç‰ˆæœ¬1 
			èŠå¤©çª—å£å›ºå®šåœ¨ä¸€ä¸ªworkspace åœ¨å…¶ä»–WorkspaceæŒ‰å¿«æ·é”®å›åˆ°è¿™ä¸ªworkspace
			
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

ğŸ‘Œ é‚£æˆ‘ç»™ä½ æ•´ç†ä¸€ä¸ª **é€šç”¨å¤šåº”ç”¨ç‰ˆæœ¬**ï¼Œåªç”¨ä¸€ä¸ªè„šæœ¬å°±èƒ½ç®¡ç†å¤šä¸ªåº”ç”¨çš„ã€Œå¯åŠ¨ â†’ éšè— â†’ æ¢å¤ã€é€»è¾‘ã€‚


è„šæœ¬ï¼š`~/scripts/toggle-app.sh`

```shell
#!/usr/bin/env bash
set -euo pipefail

STATE_DIR="/tmp/hypr_toggle_states"
mkdir -p "$STATE_DIR"

APP="$1"   # ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨åï¼Œæ¯”å¦‚ wechat/firefox/telegram
CMD="$2"   # ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯åŠ¨å‘½ä»¤ï¼Œæ¯”å¦‚ wechat/firefox/telegram-desktop

# æ‰¾çª—å£
WIN_JSON=$(hyprctl clients -j)
ADDR=$(echo "$WIN_JSON" | jq -r --arg app "$APP" '
  .[] | select((.class // "" | ascii_downcase) == ($app|ascii_downcase)) | .address' | head -n1)

if [ -z "$ADDR" ] || [ "$ADDR" = "null" ]; then
  # æ²¡æ‰¾åˆ°çª—å£å°±å¯åŠ¨
  eval "$CMD & disown"
  exit 0
fi

WIN_WS=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | .workspace.id')
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)
STATE_FILE="$STATE_DIR/${ADDR}.state"

# Helper: ç¡®è®¤çª—å£åœ¨å“ªä¸ª workspace
where_is() {
  hyprctl clients -j | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.id // "-1")'
}

# å¦‚æœçª—å£åœ¨å½“å‰ workspace -> éšè—
if [ "$WIN_WS" -eq "$CUR_WS" ]; then
  echo "$CUR_WS" > "$STATE_FILE"

  if hyprctl dispatch movetoworkspacesilent "special,address:${ADDR}" >/dev/null 2>&1; then
    exit 0
  fi

  hyprctl dispatch movetoworkspace "special,address:${ADDR}"
  hyprctl dispatch workspace "$CUR_WS"
  exit 0
fi

# å¦‚æœçª—å£åœ¨ special -> æ¢å¤
WIN_WS_NAME=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.name // "")')
if [ "$WIN_WS" = "-1" ] || echo "$WIN_WS_NAME" | grep -qi "special"; then
  OLD_WS="$CUR_WS"
  [ -f "$STATE_FILE" ] && OLD_WS=$(cat "$STATE_FILE")

  hyprctl dispatch movetoworkspacesilent "${OLD_WS},address:${ADDR}" || \
    hyprctl dispatch movetoworkspace "${OLD_WS},address:${ADDR}"

  hyprctl dispatch workspace "$OLD_WS"
  hyprctl dispatch focuswindow "address:${ADDR}"
  rm -f "$STATE_FILE"
  exit 0
fi

# çª—å£åœ¨åˆ«çš„ workspace -> åˆ‡è¿‡å»å¹¶èšç„¦
hyprctl dispatch workspace "$WIN_WS"
hyprctl dispatch focuswindow "address:${ADDR}"
exit 0

```


## ç”¨æ³•ç¤ºä¾‹

å‡è®¾ä½ è¦ç»™å¾®ä¿¡ / Firefox / Telegram è®¾ç½®å¿«æ·é”®ï¼š

### Hyprland é…ç½®

```shell
# SUPER+W -> å¾®ä¿¡
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat "wechat"

# SUPER+F -> Firefox
bind = SUPER, F, exec, ~/scripts/toggle-app.sh firefox "firefox"

# SUPER+T -> Telegram
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram "telegram-desktop"

```


## è¯´æ˜

- ç¬¬ä¸€ä¸ªå‚æ•° `$1` ç”¨æ¥åŒ¹é…çª—å£çš„ **class å**ï¼ˆé€šè¿‡ `hyprctl clients -j | jq '.[].class'` æŸ¥çœ‹å®é™…å€¼ï¼‰ã€‚
    
- ç¬¬äºŒä¸ªå‚æ•° `$2` æ˜¯åº”ç”¨çš„å¯åŠ¨å‘½ä»¤ã€‚
    
- è¿™æ ·ä¸€ä¸ªè„šæœ¬å°±èƒ½ç®¡ç†å¤šä¸ªåº”ç”¨ï¼Œé…ç½®æ–‡ä»¶é‡Œåªéœ€è¦ä¼ ä¸åŒå‚æ•°å³å¯ã€‚
    
- å¦‚æœä½ æœ‰ Wine/Deepin çš„å¾®ä¿¡ï¼Œå¯ä»¥å†™æˆï¼š
```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat "/opt/deepinwine/apps/Deepin-WeChat/wechat"
```


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++



è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª **è‡ªåŠ¨é…ç½®æ£€æµ‹å·¥å…·**ï¼Œæ¯”å¦‚è¾“å…¥åº”ç”¨åå°±èƒ½è¾“å‡ºå®ƒçš„ class å’Œä½ éœ€è¦å†™åœ¨ç»‘å®šé‡Œçš„å‘½ä»¤ï¼Ÿè¿™æ ·å¯ä»¥å¿«é€Ÿè°ƒè¯•å¾®ä¿¡è¿™ç§ç‰¹æ®Šçš„ Wine åº”ç”¨ã€‚


å¥½çš„



ğŸ‘Œ é‚£æˆ‘å¸®ä½ å†™ä¸€ä¸ª **è‡ªåŠ¨æ£€æµ‹å·¥å…·**ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾å‡ºæŸä¸ªåº”ç”¨çª—å£çš„ `class` å’Œå¯åŠ¨å‘½ä»¤ï¼Œæ–¹ä¾¿é…ç½®åˆ°è„šæœ¬é‡Œã€‚



è„šæœ¬ï¼š`~/scripts/find-app-class.sh`


```shell
#!/usr/bin/env bash
set -euo pipefail

APP="${1:-}"

if [ -z "$APP" ]; then
  echo "ç”¨æ³•: $0 <å…³é”®å­—>"
  echo "ä¾‹å¦‚: $0 wechat"
  exit 1
fi

echo "æ­£åœ¨æŸ¥æ‰¾åŒ…å« '$APP' çš„çª—å£..."

hyprctl clients -j | jq -r --arg app "$APP" '
  .[]
  | select(
      (.class // "" | ascii_downcase | contains($app|ascii_downcase))
      or
      (.title // "" | ascii_downcase | contains($app|ascii_downcase))
    )
  | "class=\(.class)  title=\(.title)  address=\(.address)  ws=\(.workspace.id)"'

```


## ç”¨æ³•

```shell
chmod +x ~/scripts/find-app-class.sh
~/scripts/find-app-class.sh wechat

```

è¾“å‡ºç¤ºä¾‹ï¼ˆä¸åŒåº”ç”¨ä¼šä¸ä¸€æ ·ï¼‰ï¼š
```shell
class=WeChat.exe  title=å¾®ä¿¡  address=0x55a6f3b  ws=2

```

è¿™æ ·ä½ å°±çŸ¥é“ï¼š

- `class` æ˜¯ `WeChat.exe`ï¼Œé‚£ä¹ˆåœ¨ `toggle-app.sh` é‡Œä¼ å‚è¦å†™ `WeChat.exe`ï¼ˆå¤§å°å†™æ•æ„Ÿï¼ï¼‰ã€‚
    
- å¯åŠ¨å‘½ä»¤åˆ™æ˜¯ä½ å¹³æ—¶è¿è¡Œå¾®ä¿¡çš„å‘½ä»¤ï¼Œæ¯”å¦‚ `/opt/deepinwine/apps/Deepin-WeChat/wechat`ã€‚

## é…ç½® Hyprland ç»‘å®š

æ‹¿åˆ°ç»“æœåï¼Œæ¯”å¦‚ä½ å‘ç°å¾®ä¿¡çš„ class æ˜¯ `WeChat.exe`ï¼Œå°±å†™ï¼š

```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh WeChat.exe "/opt/deepinwine/apps/Deepin-WeChat/wechat"

```

è¿™æ ·è„šæœ¬æ‰èƒ½æ­£ç¡®åŒ¹é…çª—å£ã€‚




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

ç‰ˆæœ¬2çš„éœ€æ±‚  ç”¨æ³•å¯ä»¥ä½¿ç”¨å‚è€ƒ1  å¿«æ·é”®è°ƒç”¨æ—¶ï¼Œä¼ è¿ä¸ªå‚æ•°

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


æˆ‘æƒ³åœ¨ä¸€ä¸ªworkspace æŒ‰å¯¹åº”å¿«æ·é”®æ—¶ wechatçª—å£å°±å‡ºç°åœ¨å¯¹åº”çš„workspace è€Œä¸æ˜¯ä¸€ç›´å‡ºç°åœ¨é‚£ä¸ªåˆå§‹çš„workspace

æ˜ç™½ âœ…  
ä½ ç°åœ¨æƒ³è¦çš„é€»è¾‘æ˜¯ï¼š

- æ¯ä¸ª workspace ä¸ŠæŒ‰å¿«æ·é”® â†’ å¾®ä¿¡çª—å£ã€Œç¬ç§»ã€åˆ°è¿™ä¸ª workspaceï¼ˆè€Œä¸æ˜¯æ€»æ˜¯å›åˆ°å®ƒæœ€åˆå¯åŠ¨çš„ workspaceï¼‰ã€‚
    
- è¿™æ ·ä½ å¯ä»¥åœ¨ **ä»»æ„ workspace** ä¸Šã€Œå¬å”¤ã€å¾®ä¿¡ï¼Œå®ƒå°±ä¼šå‡ºç°åœ¨ä½ å½“å‰æ‰€åœ¨çš„ workspaceã€‚


## æ€è·¯

æ ¸å¿ƒæ˜¯æŠŠã€Œæ¢å¤é€»è¾‘ã€æ”¹æ‰ï¼š

- ä»¥å‰æˆ‘ä»¬ä¿å­˜äº† **æœ€åˆ workspace** å¹¶æŠŠçª—å£æ¢å¤åˆ°é‚£é‡Œã€‚
    
- ç°åœ¨è¦æ”¹æˆï¼š**æ¢å¤æ—¶æ€»æ˜¯ç§»åŠ¨åˆ°å½“å‰ workspace**ï¼ˆä¹Ÿå°±æ˜¯ä½ æŒ‰å¿«æ·é”®çš„ workspaceï¼‰ã€‚


## ä¿®æ”¹ç‰ˆè„šæœ¬ï¼ˆå…³é”®å˜åŒ–ï¼‰

`~/scripts/toggle-app.sh`

```shell
#!/usr/bin/env bash
set -euo pipefail

STATE_DIR="/tmp/hypr_toggle_states"
mkdir -p "$STATE_DIR"

APP="$1"
CMD="$2"

WIN_JSON=$(hyprctl clients -j)
ADDR=$(echo "$WIN_JSON" | jq -r --arg app "$APP" '
  .[] | select((.class // "" | ascii_downcase) == ($app|ascii_downcase)) | .address' | head -n1)

if [ -z "$ADDR" ] || [ "$ADDR" = "null" ]; then
  eval "$CMD & disown"
  exit 0
fi

WIN_WS=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | .workspace.id')
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)
STATE_FILE="$STATE_DIR/${ADDR}.state"

# å¦‚æœçª—å£åœ¨å½“å‰ workspace â†’ éšè—
if [ "$WIN_WS" -eq "$CUR_WS" ]; then
  echo "hidden" > "$STATE_FILE"
  hyprctl dispatch movetoworkspacesilent "special,address:${ADDR}" || \
    { hyprctl dispatch movetoworkspace "special,address:${ADDR}"; hyprctl dispatch workspace "$CUR_WS"; }
  exit 0
fi

# å¦‚æœçª—å£åœ¨ special â†’ æ¢å¤åˆ° **å½“å‰ workspace**
WIN_WS_NAME=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | (.workspace.name // "")')
if [ "$WIN_WS" = "-1" ] || echo "$WIN_WS_NAME" | grep -qi "special"; then
  hyprctl dispatch movetoworkspacesilent "${CUR_WS},address:${ADDR}" || \
    hyprctl dispatch movetoworkspace "${CUR_WS},address:${ADDR}"

  hyprctl dispatch focuswindow "address:${ADDR}"
  rm -f "$STATE_FILE"
  exit 0
fi

# å¦‚æœçª—å£åœ¨å…¶ä»– workspace â†’ ç§»åŠ¨åˆ° **å½“å‰ workspace**
hyprctl dispatch movetoworkspacesilent "${CUR_WS},address:${ADDR}" || \
  hyprctl dispatch movetoworkspace "${CUR_WS},address:${ADDR}"

hyprctl dispatch focuswindow "address:${ADDR}"

```


## ä½¿ç”¨æ–¹å¼

è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼š

```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh WeChat.exe "/opt/deepinwine/apps/Deepin-WeChat/wechat"

```


æ•ˆæœå°±æ˜¯ï¼š

- åœ¨ä»»æ„ workspace æŒ‰ä¸‹å¿«æ·é”®ï¼Œ
    
    - å¦‚æœå¾®ä¿¡åœ¨å‰å° â†’ éšè—åˆ° special
        
    - å¦‚æœå¾®ä¿¡è¢«éšè— â†’ æ¢å¤åˆ°ã€Œå½“å‰ workspaceã€
        
    - å¦‚æœå¾®ä¿¡åœ¨åˆ«çš„ workspace â†’ æŠŠå®ƒç§»åˆ°ã€Œå½“å‰ workspaceã€


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

			                 ç‰ˆæœ¬ 2
		èŠå¤©çª—å£ä¸å›ºå®šåœ¨ä¸€ä¸ªworkspace 
		åœ¨å…¶ä»–WorkspaceæŒ‰å¿«æ·é”® èŠå¤©çª—å£ ä¼šåœ¨å¯¹åº”çš„workspaceå‡ºç°

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


å¦‚æœæ˜¯éšè—çš„çŠ¶æ€ æŒ‰å¿«æ·é”® ä¹Ÿè¦å‡ºç°åœ¨å½“å‰workspace è€Œä¸æ˜¯ä¹‹å‰çš„workspace



å¯¹çš„ ğŸ‘ ä½ è¦çš„é€»è¾‘æ˜¯ï¼š

- **éšè—æ—¶** â†’ æ”¾åˆ° `special`
    
- **å†æŒ‰å¿«æ·é”®æ¢å¤æ—¶** â†’ æ°¸è¿œå›åˆ°ã€Œå½“å‰ workspaceã€è€Œä¸æ˜¯ä¹‹å‰å¯åŠ¨çš„é‚£ä¸ª
    

ä¸Šæ¬¡è„šæœ¬é‡Œå·²ç»éƒ¨åˆ†æ”¹äº†ï¼Œä½†æ¢å¤æ—¶æˆ‘è¿˜ä¿ç•™äº†æ£€æŸ¥ `WIN_WS_NAME` çš„é€»è¾‘ï¼ˆå¯èƒ½å¯¼è‡´å›åˆ°æ—§ workspaceï¼‰ã€‚  
å’±ä»¬ç›´æ¥å½»åº•æ”¹æ‰ï¼šåªè¦åœ¨ `special` â†’ ä¸€å¾‹ç§»åˆ° **å½“å‰ workspace**ã€‚


### è„šæœ¬æ›´æ–°ç‰ˆ

`~/scripts/toggle-app.sh`

```shell
#!/usr/bin/env bash
set -euo pipefail

APP="$1"
CMD="$2"

WIN_JSON=$(hyprctl clients -j)
ADDR=$(echo "$WIN_JSON" | jq -r --arg app "$APP" '
  .[] | select((.class // "" | ascii_downcase) == ($app|ascii_downcase)) | .address' | head -n1)

if [ -z "$ADDR" ] || [ "$ADDR" = "null" ]; then
  # æ²¡æœ‰è¿è¡Œ â†’ å¯åŠ¨
  eval "$CMD & disown"
  exit 0
fi

WIN_WS=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | .workspace.id')
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)

# æƒ…å†µ 1: åœ¨å½“å‰ workspace â†’ éšè—åˆ° special
if [ "$WIN_WS" -eq "$CUR_WS" ]; then
  hyprctl dispatch movetoworkspacesilent "special,address:${ADDR}" || \
    { hyprctl dispatch movetoworkspace "special,address:${ADDR}"; hyprctl dispatch workspace "$CUR_WS"; }
  exit 0
fi

# æƒ…å†µ 2: åœ¨ special â†’ æ¢å¤åˆ°å½“å‰ workspace
if [ "$WIN_WS" = "-1" ]; then
  hyprctl dispatch movetoworkspacesilent "${CUR_WS},address:${ADDR}" || \
    hyprctl dispatch movetoworkspace "${CUR_WS},address:${ADDR}"
  hyprctl dispatch focuswindow "address:${ADDR}"
  exit 0
fi

# æƒ…å†µ 3: åœ¨åˆ«çš„ workspace â†’ ç›´æ¥æ‹‰åˆ°å½“å‰ workspace
hyprctl dispatch movetoworkspacesilent "${CUR_WS},address:${ADDR}" || \
  hyprctl dispatch movetoworkspace "${CUR_WS},address:${ADDR}"
hyprctl dispatch focuswindow "address:${ADDR}"

```


### ç»‘å®šç¤ºä¾‹

`hyprland.conf`:

```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh WeChat.exe "/opt/deepinwine/apps/Deepin-WeChat/wechat"

```

### æ•ˆæœ

- **åœ¨å½“å‰ workspace** â†’ æŒ‰ä¸‹å¿«æ·é”® â†’ éšè—åˆ° `special`
    
- **å†æŒ‰å¿«æ·é”®** â†’ ä» `special` æ‹‰å›æ¥ â†’ **å½“å‰ workspace**
    
- **åœ¨åˆ«çš„ workspace** â†’ æŒ‰å¿«æ·é”® â†’ å¾®ä¿¡çª—å£ä¼šã€Œç¬ç§»ã€è¿‡æ¥



+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


è¦ä¸è¦æˆ‘å¸®ä½ æ‰©å±•ä¸€ä¸‹ï¼ŒæŠŠ APP class å + å¯åŠ¨å‘½ä»¤ é…ç½®åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œè¿™æ ·åŒä¸€ä¸ªè„šæœ¬å°±èƒ½ç®¡ç†å¤šä¸ªåº”ç”¨ï¼ˆæ¯”å¦‚å¾®ä¿¡ã€Telegramã€Slackã€QQï¼‰ï¼Ÿ

å¥½çš„



ğŸ‘Œ é‚£æˆ‘ä»¬åšä¸€ä¸ªã€Œå¤šåº”ç”¨é€šç”¨ç‰ˆã€çš„è„šæœ¬ï¼Œä½ åªéœ€è¦åœ¨æ•°ç»„é‡Œé…ç½®å¥½åº”ç”¨çš„ **class åç§°** å’Œ **å¯åŠ¨å‘½ä»¤**ï¼Œå°±èƒ½ç”¨åŒä¸€ä»½ `toggle-app.sh` æ¥æ§åˆ¶å¾®ä¿¡ã€Telegramã€Slackã€QQ ç­‰ã€‚

---

## è„šæœ¬ï¼š`~/scripts/toggle-app.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail

# åœ¨è¿™é‡Œé…ç½®åº”ç”¨åˆ—è¡¨ï¼šclass åç§° => å¯åŠ¨å‘½ä»¤
declare -A apps=(
  ["WeChat.exe"]="/opt/deepinwine/apps/Deepin-WeChat/wechat"
  ["telegram-desktop"]="telegram-desktop"
  ["slack"]="slack"
  ["qq"]="qq"
)

APP="$1"

if [[ -z "${apps[$APP]+isset}" ]]; then
  echo "æœªçŸ¥åº”ç”¨: $APP"
  echo "å¯ç”¨: ${!apps[@]}"
  exit 1
fi

CMD="${apps[$APP]}"

WIN_JSON=$(hyprctl clients -j)
ADDR=$(echo "$WIN_JSON" | jq -r --arg app "$APP" '
  .[] | select((.class // "" | ascii_downcase) == ($app|ascii_downcase)) | .address' | head -n1)

if [ -z "$ADDR" ] || [ "$ADDR" = "null" ]; then
  # æ²¡æœ‰è¿è¡Œ â†’ å¯åŠ¨
  eval "$CMD & disown"
  exit 0
fi

WIN_WS=$(echo "$WIN_JSON" | jq -r --arg addr "$ADDR" '.[] | select(.address==$addr) | .workspace.id')
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)

# æƒ…å†µ 1: åœ¨å½“å‰ workspace â†’ éšè—åˆ° special
if [ "$WIN_WS" -eq "$CUR_WS" ]; then
  hyprctl dispatch movetoworkspacesilent "special,address:${ADDR}" || \
    { hyprctl dispatch movetoworkspace "special,address:${ADDR}"; hyprctl dispatch workspace "$CUR_WS"; }
  exit 0
fi

# æƒ…å†µ 2: åœ¨ special â†’ æ¢å¤åˆ°å½“å‰ workspace
if [ "$WIN_WS" = "-1" ]; then
  hyprctl dispatch movetoworkspacesilent "${CUR_WS},address:${ADDR}" || \
    hyprctl dispatch movetoworkspace "${CUR_WS},address:${ADDR}"
  hyprctl dispatch focuswindow "address:${ADDR}"
  exit 0
fi

# æƒ…å†µ 3: åœ¨åˆ«çš„ workspace â†’ ç›´æ¥æ‹‰åˆ°å½“å‰ workspace
hyprctl dispatch movetoworkspacesilent "${CUR_WS},address:${ADDR}" || \
  hyprctl dispatch movetoworkspace "${CUR_WS},address:${ADDR}"
hyprctl dispatch focuswindow "address:${ADDR}"
```

---

## ä½¿ç”¨æ–¹å¼ï¼ˆç»‘å®šå¿«æ·é”®ï¼‰

åœ¨ `hyprland.conf` é‡ŒåŠ ï¼š

```ini
# å¾®ä¿¡
bind = SUPER, W, exec, ~/scripts/toggle-app.sh WeChat.exe
# Telegram
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram-desktop
# Slack
bind = SUPER, S, exec, ~/scripts/toggle-app.sh slack
# QQ
bind = SUPER, Q, exec, ~/scripts/toggle-app.sh qq
```

---

## æ•ˆæœ

- æŒ‰ä¸‹å¯¹åº”å¿«æ·é”®ï¼š
    
    - å¦‚æœåº”ç”¨æ²¡å¯åŠ¨ â†’ å¯åŠ¨
        
    - å¦‚æœåœ¨å½“å‰ workspace â†’ éšè—åˆ° `special`
        
    - å¦‚æœåœ¨ `special` â†’ æ‹‰å› **å½“å‰ workspace**
        
    - å¦‚æœåœ¨åˆ«çš„ workspace â†’ æ‹‰åˆ° **å½“å‰ workspace**
        

---

