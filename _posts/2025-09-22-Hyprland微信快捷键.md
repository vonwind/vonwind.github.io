---
layout: post
tags:
  - omarchy
---









### 自动检测版脚本

保存为 `~/scripts/wechat-toggle.sh`：
```shell
#!/bin/bash

# 自动检测微信窗口 class
get_wechat_class() {
    hyprctl clients | grep -i "wechat" | grep "class:" | head -n1 | awk '{print $2}'
}

WIN_CLASS=$(get_wechat_class)

# 如果没有检测到，默认用 wechat
if [ -z "$WIN_CLASS" ]; then
    WIN_CLASS="wechat"
fi

# 检查微信是否运行
if ! pgrep -i wechat >/dev/null; then
    # 没有运行就启动
    wechat &
    exit 0
fi

# 微信在运行，检查窗口信息
WIN_INFO=$(hyprctl clients | grep -i "class: $WIN_CLASS" -A 10)

if [ -z "$WIN_INFO" ]; then
    # 没找到窗口（可能在后台），重新启动
    wechat &
    exit 0
fi

# 如果窗口已聚焦 → 最小化到一个隐藏 workspace
if echo "$WIN_INFO" | grep -q "focused: yes"; then
    hyprctl dispatch movetoworkspacesilent special:hidden "class:^(?i)$WIN_CLASS$"
else
    # 否则聚焦到它
    hyprctl dispatch focuswindow "class:^(?i)$WIN_CLASS$"
fi
```


### 使用方法

1. 给权限：
```shell
chmod +x ~/scripts/wechat-toggle.sh
```

2. 在 `~/.config/hypr/hyprland.conf` 里添加：
```shell
bind = SUPER, W, exec, ~/scripts/wechat-toggle.sh
```


这样效果就是：

- `SUPER + W`
    
    - 如果微信没开 → 启动微信
        
    - 如果微信在后台 → 切换到前台
        
    - 如果微信已在前台 → 隐藏到一个 `special:hidden` 的 workspace




## 🔹 改进后的 toggle 脚本（支持跨 workspace）

保存为 `~/scripts/toggle-app.sh`：


```shell
#!/bin/bash
APP=$1

# 检查程序是否运行
if ! pgrep -x "$APP" >/dev/null; then
    $APP &
    exit 0
fi

# 查找窗口信息
WIN_INFO=$(hyprctl clients | awk -v app="$APP" '
    BEGIN {IGNORECASE=1}
    /class:/ {cls=$2}
    /workspace:/ {ws=$2}
    /address:/ {addr=$2}
    /focused:/ {f=$2}
    {
      if (tolower(cls)==tolower(app)) {
        print cls, ws, addr, f
      }
    }')

if [ -z "$WIN_INFO" ]; then
    $APP &
    exit 0
fi

# 解析结果（取第一个匹配窗口）
read CLS WS ADDR FOCUSED <<< "$WIN_INFO"

if [ "$FOCUSED" == "yes" ]; then
    # 如果已聚焦 → 隐藏到 special:hidden
    hyprctl dispatch movetoworkspacesilent special:hidden "class:^(?i)$APP$"
else
    if [ "$WS" != "$(hyprctl activeworkspace -j | jq -r .id)" ]; then
        # 如果在其他 workspace → 切过去
        hyprctl dispatch workspace "$WS"
    fi
    # 聚焦窗口
    hyprctl dispatch focuswindow "class:^(?i)$APP$"
fi

```



## 🔹 使用方式

1. 给执行权限：
```shell
chmod +x ~/scripts/toggle-app.sh
```


2. 在 ~/.config/hypr/hyprland.conf 里配置：
```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram-desktop
bind = SUPER, B, exec, ~/scripts/toggle-app.sh firefox
bind = SUPER, Return, exec, ~/scripts/toggle-app.sh kitty
```


## 🔹 效果

- 如果没运行 → 启动
    
- 如果在当前 workspace → 聚焦或隐藏
    
- 如果在其他 workspace → 自动切换到对应 workspace 并聚焦
    
- 再按一次 → 隐藏到 `special:hidden`


```
$(hyprctl clients | awk -v app="wechat" '
    BEGIN {IGNORECASE=1}
    /class:/ {cls=$2}
    /workspace:/ {ws=$2}
    /address:/ {addr=$2}
    /focused:/ {f=$2}
    {
      if (tolower(cls)==tolower(app)) {
        print cls, ws, addr, f
      }
    }')
    
    
    hyprctl clients -j | jq -r --arg app "wechat" '
    .[] | select(.class | ascii_downcase == ($app | ascii_downcase)) 
    | "\(.class) \(.workspace.id) \(.address)"' | head -n1
    
```