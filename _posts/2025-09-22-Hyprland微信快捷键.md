---
layout: post
tags:
  - omarchy
---









### è‡ªåŠ¨æ£€æµ‹ç‰ˆè„šæœ¬

ä¿å­˜ä¸º `~/scripts/wechat-toggle.sh`ï¼š
```shell
#!/bin/bash

# è‡ªåŠ¨æ£€æµ‹å¾®ä¿¡çª—å£ class
get_wechat_class() {
    hyprctl clients | grep -i "wechat" | grep "class:" | head -n1 | awk '{print $2}'
}

WIN_CLASS=$(get_wechat_class)

# å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ï¼Œé»˜è®¤ç”¨ wechat
if [ -z "$WIN_CLASS" ]; then
    WIN_CLASS="wechat"
fi

# æ£€æŸ¥å¾®ä¿¡æ˜¯å¦è¿è¡Œ
if ! pgrep -i wechat >/dev/null; then
    # æ²¡æœ‰è¿è¡Œå°±å¯åŠ¨
    wechat &
    exit 0
fi

# å¾®ä¿¡åœ¨è¿è¡Œï¼Œæ£€æŸ¥çª—å£ä¿¡æ¯
WIN_INFO=$(hyprctl clients | grep -i "class: $WIN_CLASS" -A 10)

if [ -z "$WIN_INFO" ]; then
    # æ²¡æ‰¾åˆ°çª—å£ï¼ˆå¯èƒ½åœ¨åå°ï¼‰ï¼Œé‡æ–°å¯åŠ¨
    wechat &
    exit 0
fi

# å¦‚æœçª—å£å·²èšç„¦ â†’ æœ€å°åŒ–åˆ°ä¸€ä¸ªéšè— workspace
if echo "$WIN_INFO" | grep -q "focused: yes"; then
    hyprctl dispatch movetoworkspacesilent special:hidden "class:^(?i)$WIN_CLASS$"
else
    # å¦åˆ™èšç„¦åˆ°å®ƒ
    hyprctl dispatch focuswindow "class:^(?i)$WIN_CLASS$"
fi
```


### ä½¿ç”¨æ–¹æ³•

1. ç»™æƒé™ï¼š
```shell
chmod +x ~/scripts/wechat-toggle.sh
```

2. åœ¨ `~/.config/hypr/hyprland.conf` é‡Œæ·»åŠ ï¼š
```shell
bind = SUPER, W, exec, ~/scripts/wechat-toggle.sh
```


è¿™æ ·æ•ˆæœå°±æ˜¯ï¼š

- `SUPER + W`
    
    - å¦‚æœå¾®ä¿¡æ²¡å¼€ â†’ å¯åŠ¨å¾®ä¿¡
        
    - å¦‚æœå¾®ä¿¡åœ¨åå° â†’ åˆ‡æ¢åˆ°å‰å°
        
    - å¦‚æœå¾®ä¿¡å·²åœ¨å‰å° â†’ éšè—åˆ°ä¸€ä¸ª `special:hidden` çš„ workspace




## ğŸ”¹ æ”¹è¿›åçš„ toggle è„šæœ¬ï¼ˆæ”¯æŒè·¨ workspaceï¼‰

ä¿å­˜ä¸º `~/scripts/toggle-app.sh`ï¼š


```shell
#!/bin/bash
APP=$1

# æ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œ
if ! pgrep -x "$APP" >/dev/null; then
    $APP &
    exit 0
fi

# æŸ¥æ‰¾çª—å£ä¿¡æ¯
WIN_INFO=$(hyprctl clients | awk -v app="$APP" '
    BEGIN {IGNORECASE=1}
    /class:/ {cls=$2}
    /workspace:/ {ws=$2}
    /address:/ {addr=$2}
    /focused:/ {f=$2}
    {
      if (tolower(cls)==tolower(app)) {
        print cls, ws, addr, f
      }
    }')

if [ -z "$WIN_INFO" ]; then
    $APP &
    exit 0
fi

# è§£æç»“æœï¼ˆå–ç¬¬ä¸€ä¸ªåŒ¹é…çª—å£ï¼‰
read CLS WS ADDR FOCUSED <<< "$WIN_INFO"

if [ "$FOCUSED" == "yes" ]; then
    # å¦‚æœå·²èšç„¦ â†’ éšè—åˆ° special:hidden
    hyprctl dispatch movetoworkspacesilent special:hidden "class:^(?i)$APP$"
else
    if [ "$WS" != "$(hyprctl activeworkspace -j | jq -r .id)" ]; then
        # å¦‚æœåœ¨å…¶ä»– workspace â†’ åˆ‡è¿‡å»
        hyprctl dispatch workspace "$WS"
    fi
    # èšç„¦çª—å£
    hyprctl dispatch focuswindow "class:^(?i)$APP$"
fi

```



## ğŸ”¹ ä½¿ç”¨æ–¹å¼

1. ç»™æ‰§è¡Œæƒé™ï¼š
```shell
chmod +x ~/scripts/toggle-app.sh
```


2. åœ¨ ~/.config/hypr/hyprland.conf é‡Œé…ç½®ï¼š
```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram-desktop
bind = SUPER, B, exec, ~/scripts/toggle-app.sh firefox
bind = SUPER, Return, exec, ~/scripts/toggle-app.sh kitty
```


## ğŸ”¹ æ•ˆæœ

- å¦‚æœæ²¡è¿è¡Œ â†’ å¯åŠ¨
    
- å¦‚æœåœ¨å½“å‰ workspace â†’ èšç„¦æˆ–éšè—
    
- å¦‚æœåœ¨å…¶ä»– workspace â†’ è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº” workspace å¹¶èšç„¦
    
- å†æŒ‰ä¸€æ¬¡ â†’ éšè—åˆ° `special:hidden`


```
$(hyprctl clients | awk -v app="wechat" '
    BEGIN {IGNORECASE=1}
    /class:/ {cls=$2}
    /workspace:/ {ws=$2}
    /address:/ {addr=$2}
    /focused:/ {f=$2}
    {
      if (tolower(cls)==tolower(app)) {
        print cls, ws, addr, f
      }
    }')
    
    
    hyprctl clients -j | jq -r --arg app "wechat" '
    .[] | select(.class | ascii_downcase == ($app | ascii_downcase)) 
    | "\(.class) \(.workspace.id) \(.address)"' | head -n1
    
```




æ²¡æœ‰focused


å•Šï¼Œæ˜ç™½äº† ğŸ‘ã€‚  
ä½ åœ¨ `hyprctl clients` é‡Œçœ‹åˆ°çš„è¾“å‡ºé‡Œ **æ²¡æœ‰ `focused:` å­—æ®µ**ï¼Œè¿™æ˜¯å› ä¸º Hyprland åœ¨ä¸åŒç‰ˆæœ¬é‡Œ `clients` çš„è¾“å‡ºæ ¼å¼å˜è¿‡ã€‚

æœ‰çš„ç‰ˆæœ¬é‡Œ `hyprctl clients` è¾“å‡ºçš„æ˜¯ï¼š
```shell
class: firefox
title: Mozilla Firefox
workspace: 2
address: 0x55d9e6e
at: 1920,30
...
focusHistoryID: 12

```

æ²¡æœ‰ `focused: yes/no`ã€‚  
è¦åˆ¤æ–­æŸä¸ªçª—å£æ˜¯ä¸æ˜¯å‰å°ï¼Œå°±è¦**å¯¹æ¯”å®ƒçš„ workspace å’Œå½“å‰æ´»åŠ¨çš„ workspace**ã€‚



## ğŸ”¹ æ”¹è¿›ç‰ˆï¼ˆå…¼å®¹æ²¡æœ‰ `focused` å­—æ®µçš„æƒ…å†µï¼‰

æ›´æ–°åçš„ `toggle-app.sh`ï¼š

```shell
#!/bin/bash
APP=$1

# æ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œ
if ! pgrep -x "$APP" >/dev/null; then
    $APP &
    exit 0
fi

# å½“å‰ workspace ID
CUR_WS=$(hyprctl activeworkspace -j | jq -r .id)

# æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„çª—å£
WIN_INFO=$(hyprctl clients -j | jq -r --arg app "$APP" '
    .[] | select(.class | ascii_downcase == ($app | ascii_downcase)) 
    | "\(.class) \(.workspace.id) \(.address)"' | head -n1)

if [ -z "$WIN_INFO" ]; then
    $APP &
    exit 0
fi

read CLS WS ADDR <<< "$WIN_INFO"

if [ "$WS" -eq "$CUR_WS" ]; then
    # å¦‚æœåœ¨å½“å‰ workspace â†’ éšè—åˆ° special:hidden
    hyprctl dispatch movetoworkspacesilent special:hidden "address:$ADDR"
else
    # å¦‚æœåœ¨å…¶ä»– workspace â†’ åˆ‡æ¢å¹¶èšç„¦
    hyprctl dispatch workspace "$WS"
    hyprctl dispatch focuswindow "address:$ADDR"
fi

```


## ğŸ”¹ å…³é”®ç‚¹

- è¿™é‡Œç”¨ `hyprctl clients -j`ï¼ˆJSON æ ¼å¼ï¼‰ï¼Œå†ç”¨ `jq` è§£æï¼š
    
    - `.class` â†’ åº”ç”¨ç±»å
        
    - `.workspace.id` â†’ çª—å£æ‰€åœ¨çš„ workspace
        
    - `.address` â†’ çª—å£åœ°å€ï¼ˆå”¯ä¸€ IDï¼‰
        
- åˆ¤æ–­é€»è¾‘æ”¹æˆï¼š
    
    - **åœ¨å½“å‰ workspace** â†’ éšè—åˆ° `special:hidden`
        
    - **åœ¨å…¶ä»– workspace** â†’ åˆ‡æ¢è¿‡å»å¹¶èšç„¦



## ğŸ”¹ é…ç½®æ–¹å¼

åŒæ ·åœ¨ `hyprland.conf` é‡Œå†™ï¼š

```shell
bind = SUPER, W, exec, ~/scripts/toggle-app.sh wechat
bind = SUPER, T, exec, ~/scripts/toggle-app.sh telegram-desktop
bind = SUPER, B, exec, ~/scripts/toggle-app.sh firefox

```


è¿™æ ·å°±ä¸ä¼šä¾èµ– `focused` å­—æ®µäº† âœ…ã€‚