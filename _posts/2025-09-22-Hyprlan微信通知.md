





from gemini


### 在 Hyprland 中配置微信等软件的通知

Hyprland 作为 Wayland 合成器，需要外部通知守护进程来处理应用通知。微信（通常指 WeChat for Linux 或 uos-wechat 等第三方客户端）通过 D-Bus 发送通知，与 Telegram 类似。推荐使用 **mako**（轻量 Wayland 原生支持）或 **dunst**。以下是完整配置步骤，基于 Arch Linux（其他发行版调整包管理器即可）。

#### 步骤 1: 安装微信和通知守护进程
- **安装微信**：
  - 官方 WeChat for Linux（如果可用）：从 [腾讯官网](https://weixin.qq.com/) 下载 .deb/.rpm，或使用 AUR：
    ```
    yay -S wechat-for-linux  # Arch/AUR 用户
    # 或 flatpak install flathub com.qq.weixin.work
    ```
  - 第三方客户端（如 wechat-uos，推荐稳定）：
    ```
    yay -S wechat-uos  # 或从 GitHub 下载
    ```
  - 安装后，在微信设置中启用通知：**我 > 设置 > 通用 > 消息通知 > 开启新消息提醒**。禁用“消息提醒时置顶窗口”以避免焦点切换。

- **安装通知守护进程**：
  ```
  sudo pacman -S mako  # 推荐 mako
  # 或 sudo pacman -S dunst  # 备选 dunst
  ```

#### 步骤 2: 在 Hyprland 配置中启动守护进程
编辑 `~/.config/hypr/hyprland.conf`，在 `exec-once` 部分添加：
```
exec-once = mako  # 使用 mako
# 或 exec-once = dunst  # 使用 dunst
```

重载配置：`Super + Shift + R` 或 `hyprctl reload`。

#### 步骤 3: 配置通知守护进程
微信通知通常显示为“新消息”标题 + 聊天内容。自定义位置、样式等。

- **mako 配置**（简单推荐）：
  创建/编辑 `~/.config/mako/config`：
  ```
  # 全局设置
  font=sans-serif 10
  background-color=#333333CC  # 半透明背景
  text-color=#FFFFFF
  border-color=#FFFFFF
  border-size=2
  border-radius=10
  padding=10
  margin=10
  default-timeout=5000ms  # 5 秒显示

  # 位置：右上角
  anchor=top-right
  layer=overlay

  # 紧急通知（微信重要消息）
  [urgency=high]
  default-timeout=0  # 永久显示
  ```
  - **微信特定规则**（可选，匹配 app_name）：
    ```
    [app-name=WeChat]
    default-timeout=8000ms  # 微信通知显示 8 秒
    ```

  测试：`notify-send -a WeChat "测试" "Hello from WeChat!"`。看到通知即成功。

- **dunst 配置**（如果选择 dunst）：
  创建/编辑 `~/.config/dunst/dunstrc`：
  ```
  # 全局设置
  font = sans-serif 10
  frame_color = "#FFFFFF"
  frame_width = 2
  padding = 10
  horizontal_padding = 10
  text_icon_padding = 10
  gap_size = 10

  # 位置：右上角
  alignment = center
  origin = top-right
  offset = 10x10

  # 颜色和透明度
  transparency = 10
  background = "#333333CC"
  foreground = "#FFFFFF"
  markup = full

  # 持续时间
  timeout = 5

  # 微信规则（匹配 app_name="WeChat" 或 "wechat-uos"）
  [wechat]
  app_name = WeChat
  summary = "*"
  body = "*"
  icon = /usr/share/icons/hicolor/256x256/apps/wechat.png  # 微信图标路径（调整为实际）
  timeout = 8  # 8 秒
  urgency = normal
  ```
  测试：`notify-send -a WeChat "测试" "新消息!"`。重启：`pkill dunst`。

#### 步骤 4: 处理常见问题
- **通知不显示**：
  - 测试 D-Bus：`notify-send "Test"`。
  - 确保微信在 Wayland 模式运行：添加环境变量到 `~/.profile`：
    ```
    export QT_QPA_PLATFORM=wayland
    export ELECTRON_OZONE_PLATFORM_HINT=auto  # 如果是 Electron 版微信
    ```
  - 检查 app_name：运行微信时，用 `notify-send` 测试不同名称（如 "WeChat" 或 "org.wechat"），或用 `dbus-monitor` 监控（`dbus-monitor --session` 发送通知观察）。
  - Flatpak 版微信：添加 `--socket=wayland` 启动：`flatpak run --socket=wayland com.qq.weixin.work`。

- **焦点切换或工作区跳转**（微信常见）：
  - Hyprland 配置添加：`misc { focus_on_activate = false }`。
  - 窗口规则忽略微信：`windowrulev2 = nofocus,class:^(WeChat)$` 或 `windowrulev2 = workspace 10,class:^(WeChat)$`（固定到工作区）。
  - 微信设置中禁用“新消息弹窗”或“声音提醒”如果干扰。

- **自定义声音**：
  - mako/dunst 配置中添加 `sound-file=/usr/share/sounds/freedesktop/stereo/message.ogg`（全局）。
  - 微信自带声音，确保 PipeWire 运行：`systemctl --user start pipewire pipewire-pulse`。

- **通知历史**（可选）：
  - 安装 `swaync`：`sudo pacman -S swaync`，Hyprland conf 添加 `exec-once = swaync -g floating`。提供 GUI 查看/过滤微信通知。

#### 测试微信通知
1. 重启 Hyprland。
2. 打开微信，让朋友发消息或自发测试消息。
3. 右上角应弹出通知，点击可跳转聊天。

如果微信是特定版本（如 wechat-for-linux），app_name 可能为 "WeCom" 或 "WeChatWork"，调整规则相应。问题排查：查看 `hyprctl logs` 或 [Hyprland Wiki](https://wiki.hyprland.org/Useful-Utilities/Notification-Daemons/)。更多微信 Linux 细节见 [Arch Wiki](https://wiki.archlinux.org/title/WeChat)。配置类似其他 IM 应用！











👌 那我帮你写一个 **自动检测工具**，可以快速找出某个应用窗口的 `class` 和启动命令，方便配置到脚本里。

---

## 脚本：`~/scripts/find-app-class.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail

APP="${1:-}"

if [ -z "$APP" ]; then
  echo "用法: $0 <关键字>"
  echo "例如: $0 wechat"
  exit 1
fi

echo "正在查找包含 '$APP' 的窗口..."

hyprctl clients -j | jq -r --arg app "$APP" '
  .[]
  | select(
      (.class // "" | ascii_downcase | contains($app|ascii_downcase))
      or
      (.title // "" | ascii_downcase | contains($app|ascii_downcase))
    )
  | "class=\(.class)  title=\(.title)  address=\(.address)  ws=\(.workspace.id)"'
```

---

## 用法

```bash
chmod +x ~/scripts/find-app-class.sh
~/scripts/find-app-class.sh wechat
```

输出示例（不同应用会不一样）：

```
class=WeChat.exe  title=微信  address=0x55a6f3b  ws=2
```

这样你就知道：

- `class` 是 `WeChat.exe`，那么在 `toggle-app.sh` 里传参要写 `WeChat.exe`（大小写敏感！）。
    
- 启动命令则是你平时运行微信的命令，比如 `/opt/deepinwine/apps/Deepin-WeChat/wechat`。
    

---

## 配置 Hyprland 绑定

拿到结果后，比如你发现微信的 class 是 `WeChat.exe`，就写：

```ini
bind = SUPER, W, exec, ~/scripts/toggle-app.sh WeChat.exe "/opt/deepinwine/apps/Deepin-WeChat/wechat"
```

这样脚本才能正确匹配窗口。

---

要不要我顺便帮你做一个 **一键生成 Hyprland 配置行** 的小脚本？比如你输入 `wechat /opt/deepinwine/apps/Deepin-WeChat/wechat`，它就自动输出正确的 `bind = ...` 配置。
